# Drones Shop
____
## Навігація
- [Команда](#команда)
- [Технології](#технології)
- [Структура проєкту](#структура-проєкту)
- [Стиль написання коду](#стиль-написання-коду)
- [Робота в команді](#робота-в-команді)
- [Ендпоінти](#ендпоінти)
    - [Продукт](#продукт)
    - [Категорії](#категорії)
____
## Команда
- [Ilia Shramko](https://github.com/IllyaShramko) - Teamlead 
- [Levkovskiy Dima](https://github.com/Levkivskiydmitro) - Team Member
- [Shmatko Dmytro](https://github.com/DimaShmatko999) - Team Member
## Технології
- Node.js
- express (фреймворк)
- prisma (SQLite | MySQL)
- JsonWebToken
- Bcrypt

## Структура проєкту
Цей проєкт був створений з використанням структури "onion".
Це дозволяє легше орієнтуватися в проєкті загалом, а також забезпечує масштабованість у майбутньому.

## Стиль написання коду 
Наш стиль коду досить простий, але легко читається.
1. 4 пробіли (табуляція) для кожного рівня вкладеності для кращої читабельності
2. Порожній рядок між великими функціями або контрактами
3. Усі імпорти розміщуємо на самому початку файлу, щоб завжди можна було знайти, звідки все імпортовано
4. Назви файлів, пов'язаних з express, пишемо у dot.case

## Робота в команді
Командна робота буде реалізована через гілкування та зливання.
Приклад назви гілки: `feature/name-of-feature`
____
## Ендпоінти:
- ### Продукт:
    ##### 1. **Всі товари** (`GET`): Отримуємо список усіх товарів `/products/`
    - У ендпоінта є 3 `query`-параметри. `categoryId`, `limit`, `offset`.
    - Фільтрація за категорією товара. Для знаходження товарів по їхнією категорією, потрібно передати в query параметри `category`, тобто `category`*=*`id`
    - [Пагінація] `limit` потрібен для контролювання кількості товарів які ви отримаєте
    - [Пагінація] `offset` потрібен для контролювання скільки товарів пропустити.
    - **200** - Знайдено товари. Приклад відповіді:
        ```
        [
            {
                "name": "Name",
                "previewPhoto": "urlPhoto",
                "description": "description",
                "price": 123123,
                "discount": 0,
                "totalStorage": 5
            }
        ]
        ```
    - **400**:
        1. `limit` не є числом, або не є позитивним.
        2. `offset` не є числом, або не є позитивним.
        3. `categoryId` не є числом, або такої категорії не існує.
    - **500** - Невідома помилка сервера.
    
    
    ##### 2. **Товар по ID** (`GET`): Беремо 1 товар за його ID `/products/:id`
    - **200** - Товар існує та був успішно відображенний. Приклад відповіді:
        ```
        {
            "name": "Name",
            "previewPhoto": "urlPhoto",
            "description": "description",
            "price": 123123,
            "discount": 0,
            "totalStorage": 5,
            "category": {
                "id": 10,
                "name": "Some title",
                "icon": "Some desc"
            },
            "blocksInfo": [
                {
                    "id": 10,
                    "title": "Some title",
                    "description": "Some desc",
                    "typeView": "some",
                    "priorityView": 1,
                    "media": "image.png",
                    "productId": 1,
                    "params": [
                        {
                            "id": 1,
                            "key": "Weight",
                            "value": "200g",
                            "blockInfoId": 10
                        },
                        {
                            "id": 2,
                            "key": "Color",
                            "value": "Black",
                            "blockInfoId": 10
                        }
                    ]
                }
            ]
        }

        ```
    - **400** - Некоректний запит. ID Не є числом або не було знайдено.
    - **404** - Товар не знайдено. Тобто товару з таким ID не існує.
    - **500** - Невідома помилка сервера

    ##### 3. **Створення товару** (`POST`): Створюємо новий товар.`/products/`
    - Новий товар додається з необхідними полями, такими як назва, ціна та опис.
    - Приклад відправки інформації для створення товару (raw):
        ```
        {
            "name": "String",
            "previewPhoto": "String",
            "description": "String",
            "price": 50,
            "discount": 0,
            "totalStorage": 10,
            "categoryId":1,
            
        }
        ```
    - **201** - Товар створено.
    - **400** - Некоректний запит. Запит не відповідає вимогам API.
    - **422** - Неможливо обробити запит. Невірно передано або перевищенно обмеження за обсягом даних.
    - **500** - Невідома помилка сервера
    
    
    ##### 4. **Оновлення товару** (`PUT`): Оновлюємо інформацію про товар `/products/:id` 
    - **200** - Товар успішно оновлено. Приклад відповіді:
        ```
        {
                "name": "MName",
                "previewPhoto": "MurlPhoto",
                "description": "Mdescription",
                "price": 1231123123,
                "discount": 10,
                "totalStorage": 15
        }
        ```
    - **400** - Передано неправильний формат даних.
    - **404** - Товар не знайдено.
    - **422** - Неможливо обробити запит. Наприклад, перевищення максимуму символів.
    - **500** - Невідома помилка сервера

    ##### 5. **Видалення товару** (`DELETE`): Видаляємо твоар за його ID `/product/:id`
    - **200** - Товар було успішно знайдено та видалено. Приклад відповіді:
        ```
        {
                "name": "Name",
                "previewPhoto": "urlPhoto",
                "description": "description",
                "price": 123123,
                "discount": 0,
                "totalStorage": 5
        }
        ```
        
    - **400** - Некоректний запит. ID Не є числом або не було знайдено.
    - **404** - Товар не знайдено. Тобто товару з таким ID не існує.
    - **500** - Невідома помилка сервера
    ##### 5. **Отримання спец. товарів** (`GET`): Отримуємо нові або популярні товари `/product/suggestions`
    - У ендпоінта є 5 `query`-параметри. `popular`, `new`, `limit`, `offset`, `sameAs`.
    - Якщо потрібно отримати популярні продукти, потрібно ввести у `query`-параметри: `popular=true`.
        - Популярні товари - це товари в яких більше всього заказів
    - Якщо потрібно отримати нові продукти, потрібно ввести у `query`-параметри: `new=true`
        - Нові товари - це товари, які були створенні зовсім нещодавно 
    - Якщо ввести 2 параметра одночасно - отримаєте помилку
    - `sameAs` - приймає id товару, до якого ви хочете отримати схожі товари. Схожість товарів виявляється за:
        1. Схожими словами у назві
        2. З той самої категорії
        3. +-n від вартості товару
    - [Пагінація] `limit` потрібен для контролювання кількості товарів які ви отримаєте
    - [Пагінація] `offset` потрібен для контролювання скільки товарів пропустити.
    - **200** - Знайдено товари. Приклад відповіді:
        ```
        [
            {
                "id": 1
                "name": "Name",
                "previewPhoto": "urlPhoto",
                "description": "description",
                "price": 123123,
                "discount": 0,
                "totalStorage": 5
            }
        ]
        ```
    - **400** - Задано одночасно 2 параметра (`popular` і `new`), або передано неправильний тип даних для `query`-параметрів.
    - **500** - Невідома помилка сервера.
- ### Категорії:
    ##### 1. **Всі категорії** (`GET`): Отримуємо список усіх категорій `/category/`
    - **200** - Знайдено категорії. Приклад відповіді:
        ```
        [
            {
                "id": "1"
                "name": "Name",
                "icon": "urlPhoto"
            }
        ]
        ```
    - **500** - Невідома помилка сервера.
    
    ##### 2. **Категорія по ID** (`GET`): Беремо 1 категорія за його ID `/category/:id`
    - **200** - Категорія існує та був успішно відображенний. Приклад відповіді:
        ```
        {
            "id": "1"
            "name": "Name",
            "icon": "urlPhoto"
        }
        ```
    - **400** - Некоректний запит. ID Не є числом або не було знайдено.
    - **404** - Товар не знайдено. Тобто категорії з таким ID не існує.
    - **500** - Невідома помилка сервера

    ##### 3. **Створення категорії** (`POST`): Створюємо новий категорію.`/category/`
    - Нова категорія додається з необхідними полями, такими як назва, іконка.
    - **201** - Категорію створено.
    - **400** - Некоректний запит. Запит не відповідає вимогам API.
    - **422** - Неможливо обробити запит. Невірно передано або перевищенно обмеження за обсягом даних.
    - **500** - Невідома помилка сервера
    
    
    ##### 4. **Оновлення категорії** (`PUT`): Оновлюємо інформацію про товар `/category/:id` 
    - **200** - Категорія успішно оновлена. Приклад відповіді:
        ```
        {
            "id": "1"
            "name": "Name",
            "icon": "urlPhoto"
        }
        ```
    - **400** - Передано неправильний формат даних.
    - **404** - Категорію не знайдено.
    - **422** - Неможливо обробити запит. Наприклад, перевищення максимуму символів.
    - **500** - Невідома помилка сервера

    ##### 5. **Видалення категорії** (`DELETE`): Видаляємо категорію за його ID `/category/:id`
    - **200** - Категорія було успішно знайдено та видалено. Приклад відповіді:
        ```
        {
            "id": "1"
            "name": "Name",
            "icon": "urlPhoto"
        }
        ```
        
    - **400** - Некоректний запит. ID Не є числом або не було знайдено.
    - **404** - Категорію не знайдено. Тобто категорії з таким ID не існує.
    - **500** - Невідома помилка сервера
- ### Користувач:
    ##### 1. **Реєстрація** (`POST`): Створюємо нового користувача `/user/register/`
    - Дані, які потрібні для створення нового користувача: 
        ```
        {
            "firstName": string,
            "email": string,
            "password": string
        }        
        ```
    - **201** - Користувач був успішно створений. У відповідь ви отримаєте JWT токен.
    - **400** - Передано неправильний формат даних.
    - **409** - Такий користувач з такою поштою вже існує.
    - **500** - Невідома помилка сервера
    
    ##### 2. **Авторизація** (`POST`): Авторизуємо користовача надісланими даними `/user/login/`
    - Дані, які потрібні для входу користувача: 
        ```
        {
            "email": string,
            "password": string
        }        
        ```
    - **200** - Користувач був успішно авторизован. У відповідь ви отримаєте JWT токен.
    - **400** - Передано неправильний формат даних.
    - **404** - Такий користувач з такою поштою не існує.
    - **500** - Невідома помилка сервера
    ##### 3. **Відновлення паролю** (`POST`)  `/user/password/`
    - Приклад запиту:
        ```
        {
            "email": "example@gmail.com"
        }
        ```
    - **200** - Код для зміненння паролю успішно відправленний. Відповідь:
        ```
        {
            "OK" 
        }
        ```
    - **500** - Невідома помилка сервера
    ##### 3.1 **Перевірка коду** (`GET`) `/user/password/:code`
    - Передаємо у query параметри код який ми отримали з пошти
    - **200** - Код був прийнятий та перевіренний з існуючими. Відповідь:
        ```
        {
            "success": True | False
        }
        ```
    ##### 3.2 **Змінення паролю** (`PATCH`) `/user/password/`
    - Передаємо новий пароль:
        ```
        {
            "password": "newPassword"
        }
        ```
    - **200** - Пароль був успішно зміненний. У відповідь ви отримаєте JWT токен.
    - **404** - Користувач з таким email не був знайдений.

    ##### 4. **Отримання контактних данних** (`GET`): Отримуємо контактні дані користувача `/user/me/`
    - **200** - Контакні дані успішно отримані. Приклад відповідді: 
        ```
        {
            "id": 1,
            "firstName": "cool",
            "lastName": "boy" | null,
            "patronymic": "run away" | null,
            "birthrday": "1763155148939" | null,
            "phoneNumber": "079111111" | null,
            "email": "tgmxdnxt@fringmail.com"
        }
        ```
    - **400** - Передано неправильний формат даних.
    - **401** - Немає доступу без авторизації.
    - **500** - Невідома помилка сервера
    ##### 5. **Змінення контактних данних** (`PUT`): Змінюємо контактні дані користувача `/user/me/`
    - id користувача береться з JWT-токену користувача.
    - Приклад запиту:
        ```
        {
            "firstName": "cool",
            "lastName": "boy",
            "patronymic": "run away",
            "birthrday": "1763155148939",
            "phoneNumber": "079111111",
            "email": "tgmxdnxt@fringmail.com"
        }
        ```
    - **200** - Контакні дані успішно змінені. Приклад відповідді: 
        ```
        {
            "id": 1,
            "firstName": "cool",
            "lastName": "boy",
            "patronymic": "run away",
            "birthrday": "1763155148939",
            "phoneNumber": "079111111",
            "email": "tgmxdnxt@fringmail.com"
        }
        ```
    - **400** - Передано неправильний формат даних.
    - **401** - Немає доступу без авторизації.
    - **500** - Невідома помилка сервера
    ##### 6. **Отримання моїх замовлення** (`GET`): Отримання поточних замовлень `/user/orders/`
    - **200** - Данні моїх замовлень успішно отримані. Приклад відповідді: 
        ```
        [
            {
                "id": 1,
                "firstName": "cool",
                "lastName": "boy",
                "patronymic": "run away",
                "phoneNumber": "079111111",
                "adress": {
                    "id": 1,
                    "city": "Dnipro",
                    "street": "polana",
                    "houseNumber": 10,
                    "apartamentNumber": 11,
                    "entranceNumer": 12
                },
                "status": "Оформлено",
                "totalPrice": 11111,
                "discountPrice": 11,
                "productOnOrder": [
                    {
                        "ordered": 2,
                        "product": {
                            "name": "Drone X",
                            "previewPhoto": "photo_url",
                            "price": 1000,
                            "discount": 10
                        }
                    }
                ],
                "typePay": "Накладений платіж"
            }
        ]
        ```
    - **400** - Передано неправильний формат даних.
    - **401** - Немає доступу без авторизації.
    - **500** - Невідома помилка сервера
    ##### 7. **Скасування моїх замовлення** (`DELETE`): Скасування поточного замовлення `/user/orders/:id`
    - **200** - Замовлення скасовано (видалено).
    - **400** - Передано неправильний формат даних.
    - **401** - Немає доступу без авторизації.
    - **500** - Невідома помилка сервера.
    ##### 8. **Отримання моїх адрес доставки** (`GET`): Отримання адрес доставки `/user/addresses/`
    - Отримання своїх адрес доставки.
    - **200** - Адреса доставки успішно отримані. Приклад відповідді: 
        ```
        [
            {
                "id": 1,
                "city": "Dnipro",
                "street": "polana",
                "houseNumber": 10,
                "apartamentNumber": 11,
                "entranceNumer": 12
            },
            {
                "id": 2,
                "city": "Dnipro",
                "street": "polana",
                "houseNumber": 10,
                "apartamentNumber": 11,
                "entranceNumer": 12
            },
        ]
        ```
    - **401** - Немає доступу без авторизації.
    - **500** - Невідома помилка сервера
    ##### 9. **Додавання адресу доставки** (`POST`): Додавання адресу доставки `/user/addresses/`
    - Додавання нового адресу доставки.
    - Приклад запиту:
        ```
        {
            "city": "Dnipro",
            "street": "polana",
            "houseNumber": 10,
            "apartamentNumber": 11,
            "entranceNumer": 12
        }
        ```
    - **201** - Успішно додан новий адрес доставки. Приклад відповідді: 
        ```
        {
            "id": 1
            "city": "Dnipro",
            "street": "polana",
            "houseNumber": 10,
            "apartamentNumber": 11,
            "entranceNumer": 12
        }
        ```
    - **400** - Передано неправильний формат даних.
    - **401** - Немає доступу без авторизації.
    - **500** - Невідома помилка сервера
    ##### 10. **Змінення адресу доставки** (`PUT`): Змінення адресу доставки `/user/addresses/:id`
    - Змінення адресу доставки.
    - Приклад запиту `/user/addresses/1`:
        ```
        {
            "city": "Dnipro",
            "street": "polana",
            "houseNumber": 10,
            "apartamentNumber": 11,
            "entranceNumer": 12
        }
        ```
    - **201** - Успішно додан новий адрес доставки. Приклад відповідді: 
        ```
        {
            "id": 1
            "city": "Dnipro",
            "street": "polana",
            "houseNumber": 10,
            "apartamentNumber": 11,
            "entranceNumer": 12
        }
        ```
    - **400** - Передано неправильний формат даних.
    - **401** - Немає доступу без авторизації.
    - **500** - Невідома помилка сервера
